#include "shear_derivatives.h"

/*
 *  ==========================================
 *      Shear Energy, 1st derivatives
 *  ==========================================
 */

double dEsh_dx1(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                const double& a0, const double& ksh) {
    return a0*ksh*((2*(-v2(1) + v3(1))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(v2(2) - v3(2))*
                                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                     v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                             v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           (-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                          v1(0)*v3(1) - v2(0)*v3(1),2) +
                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                          v2(1)*v3(2),2))/
                 (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
                  sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                       pow(-v2(2) + v3(2),2))));
}
double dEsh_dx2(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                const double& a0, const double& ksh) {
    return a0*ksh*((2*(v1(1) - v3(1))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                       v1(0)*v3(1) - v2(0)*v3(1)) +
                    2*(-v1(2) + v3(2))*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) -
                                        v3(0)*v2(2) - v1(0)*v3(2) + v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                        pow(-v2(2) + v3(2),2),1.5)) +
                   ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                             v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           (-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                          v1(0)*v3(1) - v2(0)*v3(1),2) +
                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                          v2(1)*v3(2),2))/
                 (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
                  sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                       pow(-v2(2) + v3(2),2))));
}
double dEsh_dx3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                const double& a0, const double& ksh) {
    return a0*ksh*((2*(-v1(1) + v2(1))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(v1(2) - v2(2))*
                                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                     v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                        pow(-v2(2) + v3(2),2),1.5)))*
           (-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                          v1(0)*v3(1) - v2(0)*v3(1),2) +
                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                          v2(1)*v3(2),2))/
                 (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
                  sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                       pow(-v2(2) + v3(2),2))));
}
double dEsh_dy1(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                const double& a0, const double& ksh) {
    return a0*ksh*((2*(v2(0) - v3(0))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                       v1(0)*v3(1) - v2(0)*v3(1)) +
                    2*(-v2(2) + v3(2))*(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                        v1(1)*v3(2) - v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                             v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           (-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                          v1(0)*v3(1) - v2(0)*v3(1),2) +
                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                          v2(1)*v3(2),2))/
                 (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
                  sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                       pow(-v2(2) + v3(2),2))));
}
double dEsh_dy2(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                const double& a0, const double& ksh) {
    return a0*ksh*((2*(-v1(0) + v3(0))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(v1(2) - v3(2))*
                                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                        pow(-v2(2) + v3(2),2),1.5)) +
                   ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                             v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           (-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                          v1(0)*v3(1) - v2(0)*v3(1),2) +
                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                          v2(1)*v3(2),2))/
                 (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
                  sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                       pow(-v2(2) + v3(2),2))));
}
double dEsh_dy3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                const double& a0, const double& ksh) {
    return a0*ksh*((2*(v1(0) - v2(0))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                       v1(0)*v3(1) - v2(0)*v3(1)) +
                    2*(-v1(2) + v2(2))*(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                        v1(1)*v3(2) - v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                        pow(-v2(2) + v3(2),2),1.5)))*
           (-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                          v1(0)*v3(1) - v2(0)*v3(1),2) +
                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                          v2(1)*v3(2),2))/
                 (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
                  sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                       pow(-v2(2) + v3(2),2))));
}
double dEsh_dz1(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                const double& a0, const double& ksh) {
    return a0*ksh*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                 v2(1)*v3(2),2))/
                        (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                              pow(v1(2) - v2(2),2))*
                         sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                              pow(-v2(2) + v3(2),2))))*
           ((2*(-v2(0) + v3(0))*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2)) +
             2*(v2(1) - v3(1))*(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                      v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))));
}
double dEsh_dz2(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                const double& a0, const double& ksh) {
    return a0*ksh*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                 v2(1)*v3(2),2))/
                        (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                              pow(v1(2) - v2(2),2))*
                         sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                              pow(-v2(2) + v3(2),2))))*
           ((2*(v1(0) - v3(0))*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2)) +
             2*(-v1(1) + v3(1))*(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                       v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                   pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2),2) +
                                   pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                       v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                 pow(-v2(2) + v3(2),2),1.5)) +
            ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                      v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))));
}
double dEsh_dz3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                const double& a0, const double& ksh) {
    return a0*ksh*((2*(-v1(0) + v2(0))*
                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                     v2(0)*v3(2)) + 2*(v1(1) - v2(1))*
                                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                        pow(-v2(2) + v3(2),2),1.5)))*
           (-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                          v1(0)*v3(1) - v2(0)*v3(1),2) +
                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                          v2(1)*v3(2),2))/
                 (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
                  sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                       pow(-v2(2) + v3(2),2))));
}

/*
 *  ==========================================
 *      Shear Energy, 2nd derivatives
 *  ==========================================
 */

double ddEsh_dx1dx1(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*pow((2*(-v2(1) + v3(1))*
                       (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                        v2(0)*v3(1)) + 2*(v2(2) - v3(2))*
                                       (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                        v2(0)*v3(2)))/
                      (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                               pow(v1(2) - v2(2),2))*
                       sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                            pow(-v2(2) + v3(2),2))*
                       sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                v1(0)*v3(1) - v2(0)*v3(1),2) +
                            pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2),2) +
                            pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2),2))) -
                      ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                                v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                            pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                                v1(0)*v3(2) + v2(0)*v3(2),2) +
                                            pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                                v1(1)*v3(2) - v2(1)*v3(2),2)))/
                      (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                           pow(v1(2) - v2(2),2),1.5)*
                       sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                            pow(-v2(2) + v3(2),2))),2) +
           a0*ksh*(-pow(2*(-v2(1) + v3(1))*
                        (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                         v2(0)*v3(1)) +
                        2*(v2(2) - v3(2))*
                        (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                         v1(0)*v3(2) + v2(0)*v3(2)),2)/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*pow(-v2(1) + v3(1),2) + 2*pow(v2(2) - v3(2),2))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(0) - v2(0))*(2*(-v2(1) + v3(1))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(v2(2) - v3(2))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2))))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   (3*pow(v1(0) - v2(0),2)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),2.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))) -
                   sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           (-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                          v1(0)*v3(1) - v2(0)*v3(1),2) +
                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                          v1(1)*v3(2) - v2(1)*v3(2),2))/
                 (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
                  sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                       pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx1dx2(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(-v2(1) + v3(1))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(v2(2) - v3(2))*
                                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                     v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                             v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           ((2*(v1(1) - v3(1))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                v1(0)*v3(1) - v2(0)*v3(1)) +
             2*(-v1(2) + v3(2))*
             (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
              v2(0)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                       v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                   pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2),2) +
                                   pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                       v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            + ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                        v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),1.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2)))) +
           a0*ksh*(-((2*(-v2(1) + v3(1))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(v2(2) - v3(2))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)))*
                     (2*(v1(1) - v3(1))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(-v1(2) + v3(2))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(v1(1) - v3(1))*(-v2(1) + v3(1)) +
                    2*(v2(2) - v3(2))*(-v1(2) + v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(0) + v3(0))*(2*(-v2(1) + v3(1))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(v2(2) - v3(2))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(0) - v2(0))*(2*(-v2(1) + v3(1))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(v2(2) - v3(2))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(0) - v2(0))*(2*(v1(1) - v3(1))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(-v1(2) + v3(2))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(0) - v2(0))*(-v2(0) + v3(0))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                   - (3*pow(v1(0) - v2(0),2)*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),2.5)*
                      sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                           pow(-v2(2) + v3(2),2))) +
                   sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           (-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                          v1(0)*v3(1) - v2(0)*v3(1),2) +
                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                          v1(1)*v3(2) - v2(1)*v3(2),2))/
                 (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
                  sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                       pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx1dx3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(-v1(1) + v2(1))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(v1(2) - v2(2))*
                                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                     v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*((2*(-v2(1) + v3(1))*
        (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
         v2(0)*v3(1)) + 2*(v2(2) - v3(2))*
                        (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                         v2(0)*v3(2)))/
       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                pow(v1(2) - v2(2),2))*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2))*
        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                 v1(0)*v3(1) - v2(0)*v3(1),2) +
             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                 v1(0)*v3(2) + v2(0)*v3(2),2) +
             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                 v1(1)*v3(2) - v2(1)*v3(2),2))) -
       ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2)))/
       (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
            pow(v1(2) - v2(2),2),1.5)*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2)))) +
           a0*ksh*(-((2*(-v1(1) + v2(1))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(v1(2) - v2(2))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)))*
                     (2*(-v2(1) + v3(1))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(v2(2) - v3(2))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(-v1(1) + v2(1))*(-v2(1) + v3(1)) +
                    2*(v1(2) - v2(2))*(v2(2) - v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(0) - v2(0))*(2*(-v1(1) + v2(1))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(v1(2) - v2(2))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(0) + v3(0))*(2*(-v2(1) + v3(1))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(v2(2) - v3(2))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(0) - v2(0))*(-v2(0) + v3(0))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                            v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx1dy1(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(-v2(1) + v3(1))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(v2(2) - v3(2))*
                                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                     v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                             v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           ((2*(v2(0) - v3(0))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                v1(0)*v3(1) - v2(0)*v3(1)) +
             2*(-v2(2) + v3(2))*
             (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
              v2(1)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                      v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2)))) +
           a0*ksh*(-((2*(-v2(1) + v3(1))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(v2(2) - v3(2))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)))*
                     (2*(v2(0) - v3(0))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(-v2(2) + v3(2))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   ((v2(0) - v3(0))*(-v2(1) + v3(1)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(1) - v2(1))*(2*(-v2(1) + v3(1))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(v2(2) - v3(2))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(0) - v2(0))*(2*(v2(0) - v3(0))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(-v2(2) + v3(2))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   (3*(v1(0) - v2(0))*(v1(1) - v2(1))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),2.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           (-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                          v1(0)*v3(1) - v2(0)*v3(1),2) +
                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                          v1(1)*v3(2) - v2(1)*v3(2),2))/
                 (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
                  sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                       pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx1dy2(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(-v2(1) + v3(1))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(v2(2) - v3(2))*
                                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                     v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                             v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           ((2*(-v1(0) + v3(0))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                 v1(0)*v3(1) - v2(0)*v3(1)) +
             2*(v1(2) - v3(2))*(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                       v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                   pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2),2) +
                                   pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                       v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            + ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                        v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),1.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2)))) +
           a0*ksh*(-((2*(-v2(1) + v3(1))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(v2(2) - v3(2))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)))*
                     (2*(-v1(0) + v3(0))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(v1(2) - v3(2))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(-v1(0) + v3(0))*(-v2(1) + v3(1)) -
                    2*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(1) + v3(1))*(2*(-v2(1) + v3(1))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(v2(2) - v3(2))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(1) - v2(1))*(2*(-v2(1) + v3(1))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(v2(2) - v3(2))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(0) - v2(0))*(2*(-v1(0) + v3(0))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(v1(2) - v3(2))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(0) - v2(0))*(-v2(1) + v3(1))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                   - (3*(v1(0) - v2(0))*(v1(1) - v2(1))*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),2.5)*
                      sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                           pow(-v2(2) + v3(2),2))))*
           (-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                          v1(0)*v3(1) - v2(0)*v3(1),2) +
                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                          v1(1)*v3(2) - v2(1)*v3(2),2))/
                 (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
                  sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                       pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx1dy3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(v1(0) - v2(0))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                       v1(0)*v3(1) - v2(0)*v3(1)) +
                    2*(-v1(2) + v2(2))*
                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*((2*(-v2(1) + v3(1))*
        (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
         v2(0)*v3(1)) + 2*(v2(2) - v3(2))*
                        (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                         v2(0)*v3(2)))/
       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                pow(v1(2) - v2(2),2))*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2))*
        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                 v1(0)*v3(1) - v2(0)*v3(1),2) +
             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                 v1(0)*v3(2) + v2(0)*v3(2),2) +
             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                 v1(1)*v3(2) - v2(1)*v3(2),2))) -
       ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2)))/
       (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
            pow(v1(2) - v2(2),2),1.5)*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2)))) +
           a0*ksh*(-((2*(-v2(1) + v3(1))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(v2(2) - v3(2))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)))*
                     (2*(v1(0) - v2(0))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(-v1(2) + v2(2))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(v1(0) - v2(0))*(-v2(1) + v3(1)) +
                    2*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(1) + v3(1))*(2*(-v2(1) + v3(1))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(v2(2) - v3(2))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(0) - v2(0))*(2*(v1(0) - v2(0))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(-v1(2) + v2(2))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(0) - v2(0))*(-v2(1) + v3(1))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                            v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx1dz1(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))/
                        (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                              pow(v1(2) - v2(2),2))*
                         sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                              pow(-v2(2) + v3(2),2))))*
           (-((2*(-v2(1) + v3(1))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                   v1(0)*v3(1) - v2(0)*v3(1)) +
               2*(v2(2) - v3(2))*
               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                v1(0)*v3(2) + v2(0)*v3(2)))*
              (2*(-v2(0) + v3(0))*
               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                v1(0)*v3(2) + v2(0)*v3(2)) +
               2*(v2(1) - v3(1))*
               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                v2(1)*v3(2))))/
            (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                     v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
            ((-v2(0) + v3(0))*(v2(2) - v3(2)))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(2) - v2(2))*(2*(-v2(1) + v3(1))*
                              (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                               v2(0)*v3(1)) +
                              2*(v2(2) - v3(2))*
                              (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2))))/
            (2.*pow(pow(v1(0) - v2(0),2) +
                    pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(0) - v2(0))*(2*(-v2(0) + v3(0))*
                              (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2)) +
                              2*(v2(1) - v3(1))*
                              (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                               v2(1)*v3(2))))/
            (2.*pow(pow(v1(0) - v2(0),2) +
                    pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            (3*(v1(0) - v2(0))*(v1(2) - v2(2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),2.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2)))) +
           a0*ksh*((2*(-v2(1) + v3(1))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(v2(2) - v3(2))*
                                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                     v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                             v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           ((2*(-v2(0) + v3(0))*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) -
                                 v3(0)*v2(2) - v1(0)*v3(2) + v2(0)*v3(2)) +
             2*(v2(1) - v3(1))*(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                      v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx1dz2(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))/
                        (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                              pow(v1(2) - v2(2),2))*
                         sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                              pow(-v2(2) + v3(2),2))))*
           (-((2*(-v2(1) + v3(1))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                   v1(0)*v3(1) - v2(0)*v3(1)) +
               2*(v2(2) - v3(2))*
               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                v1(0)*v3(2) + v2(0)*v3(2)))*
              (2*(v1(0) - v3(0))*
               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                v1(0)*v3(2) + v2(0)*v3(2)) +
               2*(-v1(1) + v3(1))*
               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                v2(1)*v3(2))))/
            (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                     v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
            (2*(v1(0) - v3(0))*(v2(2) - v3(2)) +
             2*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                v1(0)*v3(2) + v2(0)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(2) + v3(2))*(2*(-v2(1) + v3(1))*
                               (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                v2(0)*v3(1)) +
                               2*(v2(2) - v3(2))*
                               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2))))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((v1(2) - v2(2))*(2*(-v2(1) + v3(1))*
                              (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                               v2(0)*v3(1)) +
                              2*(v2(2) - v3(2))*
                              (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2))))/
            (2.*pow(pow(v1(0) - v2(0),2) +
                    pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(0) - v2(0))*(2*(v1(0) - v3(0))*
                              (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2)) +
                              2*(-v1(1) + v3(1))*
                              (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                               v2(1)*v3(2))))/
            (2.*pow(pow(v1(0) - v2(0),2) +
                    pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(0) - v2(0))*(-v2(2) + v3(2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),1.5)*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            - (3*(v1(0) - v2(0))*(v1(2) - v2(2))*
               sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                        v1(0)*v3(1) - v2(0)*v3(1),2) +
                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),2.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2)))) +
           a0*ksh*((2*(-v2(1) + v3(1))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(v2(2) - v3(2))*
                                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                     v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                             v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           ((2*(v1(0) - v3(0))*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2)) +
             2*(-v1(1) + v3(1))*
             (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
              v2(1)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                       v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                   pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2),2) +
                                   pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                       v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            + ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                        v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),1.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx1dz3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(-v1(0) + v2(0))*
                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                     v2(0)*v3(2)) + 2*(v1(1) - v2(1))*
                                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*((2*(-v2(1) + v3(1))*
        (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
         v2(0)*v3(1)) + 2*(v2(2) - v3(2))*
                        (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                         v2(0)*v3(2)))/
       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                pow(v1(2) - v2(2),2))*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2))*
        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                 v1(0)*v3(1) - v2(0)*v3(1),2) +
             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                 v1(0)*v3(2) + v2(0)*v3(2),2) +
             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                 v1(1)*v3(2) - v2(1)*v3(2),2))) -
       ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2)))/
       (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
            pow(v1(2) - v2(2),2),1.5)*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2)))) +
           a0*ksh*(-((2*(-v2(1) + v3(1))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(v2(2) - v3(2))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)))*
                     (2*(-v1(0) + v2(0))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)) +
                      2*(v1(1) - v2(1))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(-v1(0) + v2(0))*(v2(2) - v3(2)) -
                    2*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(2) + v3(2))*(2*(-v2(1) + v3(1))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(v2(2) - v3(2))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(0) - v2(0))*(2*(-v1(0) + v2(0))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2)) +
                                     2*(v1(1) - v2(1))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(0) - v2(0))*(-v2(2) + v3(2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                            v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))));
}

double ddEsh_dx2dx2(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*pow((2*(v1(1) - v3(1))*
                       (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                        v2(0)*v3(1)) + 2*(-v1(2) + v3(2))*
                                       (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                        v2(0)*v3(2)))/
                      (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                               pow(v1(2) - v2(2),2))*
                       sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                            pow(-v2(2) + v3(2),2))*
                       sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                v1(0)*v3(1) - v2(0)*v3(1),2) +
                            pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2),2) +
                            pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2),2))) +
                      ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                                 v1(1)*v3(2) - v2(1)*v3(2),2)))/
                      (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                       pow(pow(-v2(0) + v3(0),2) +
                           pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                      + ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                                  v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                              pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                                  v1(0)*v3(2) + v2(0)*v3(2),2) +
                                              pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                                  v1(1)*v3(2) - v2(1)*v3(2),2)))/
                        (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                             pow(v1(2) - v2(2),2),1.5)*
                         sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                              pow(-v2(2) + v3(2),2))),2) +
           a0*ksh*(-pow(2*(v1(1) - v3(1))*
                        (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                         v2(0)*v3(1)) +
                        2*(-v1(2) + v3(2))*
                        (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                         v1(0)*v3(2) + v2(0)*v3(2)),2)/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*pow(v1(1) - v3(1),2) + 2*pow(-v1(2) + v3(2),2))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(0) + v3(0))*(2*(v1(1) - v3(1))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(-v1(2) + v3(2))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2))))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(0) - v2(0))*(2*(v1(1) - v3(1))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(-v1(2) + v3(2))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2))))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   (3*pow(-v2(0) + v3(0),2)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
                   + (2*(v1(0) - v2(0))*(-v2(0) + v3(0))*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),1.5)*
                      pow(pow(-v2(0) + v3(0),2) +
                          pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                   - sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                              v1(0)*v3(1) - v2(0)*v3(1),2) +
                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                              v1(1)*v3(2) - v2(1)*v3(2),2))/
                     (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                           pow(v1(2) - v2(2),2))*
                      pow(pow(-v2(0) + v3(0),2) +
                          pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                   + (3*pow(v1(0) - v2(0),2)*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),2.5)*
                      sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                           pow(-v2(2) + v3(2),2))) -
                   sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           (-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                          v1(0)*v3(1) - v2(0)*v3(1),2) +
                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                          v1(1)*v3(2) - v2(1)*v3(2),2))/
                 (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
                  sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                       pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx2dx3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(-v1(1) + v2(1))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(v1(2) - v2(2))*
                                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                     v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*((2*(v1(1) - v3(1))*
        (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
         v2(0)*v3(1)) + 2*(-v1(2) + v3(2))*
                        (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                         v2(0)*v3(2)))/
       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                pow(v1(2) - v2(2),2))*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2))*
        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                 v1(0)*v3(1) - v2(0)*v3(1),2) +
             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                 v1(0)*v3(2) + v2(0)*v3(2),2) +
             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                 v1(1)*v3(2) - v2(1)*v3(2),2))) +
       ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                  v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                              pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                  v1(0)*v3(2) + v2(0)*v3(2),2) +
                              pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                  v1(1)*v3(2) - v2(1)*v3(2),2)))/
       (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
             pow(v1(2) - v2(2),2))*
        pow(pow(-v2(0) + v3(0),2) +
            pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
       + ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                   v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                               pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                   v1(0)*v3(2) + v2(0)*v3(2),2) +
                               pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                   v1(1)*v3(2) - v2(1)*v3(2),2)))/
         (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
              pow(v1(2) - v2(2),2),1.5)*
          sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
               pow(-v2(2) + v3(2),2)))) +
           a0*ksh*(-((2*(-v1(1) + v2(1))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(v1(2) - v2(2))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)))*
                     (2*(v1(1) - v3(1))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(-v1(2) + v3(2))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(-v1(1) + v2(1))*(v1(1) - v3(1)) +
                    2*(v1(2) - v2(2))*(-v1(2) + v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(0) + v3(0))*(2*(-v1(1) + v2(1))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(v1(2) - v2(2))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(0) - v2(0))*(2*(-v1(1) + v2(1))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(v1(2) - v2(2))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(0) + v3(0))*(2*(v1(1) - v3(1))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(-v1(2) + v3(2))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   (3*pow(-v2(0) + v3(0),2)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
                   - ((v1(0) - v2(0))*(-v2(0) + v3(0))*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),1.5)*
                      pow(pow(-v2(0) + v3(0),2) +
                          pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                   + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                              v1(0)*v3(1) - v2(0)*v3(1),2) +
                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                              v1(1)*v3(2) - v2(1)*v3(2),2))/
                     (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                           pow(v1(2) - v2(2),2))*
                      pow(pow(-v2(0) + v3(0),2) +
                          pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                            v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx2dy1(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(v1(1) - v3(1))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                       v1(0)*v3(1) - v2(0)*v3(1)) +
                    2*(-v1(2) + v3(2))*
                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                     v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                   + ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                               v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),1.5)*
                      sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                           pow(-v2(2) + v3(2),2))))*
           ((2*(v2(0) - v3(0))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                v1(0)*v3(1) - v2(0)*v3(1)) +
             2*(-v2(2) + v3(2))*
             (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
              v2(1)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                      v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2)))) +
           a0*ksh*(-((2*(v1(1) - v3(1))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(-v1(2) + v3(2))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)))*
                     (2*(v2(0) - v3(0))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(-v2(2) + v3(2))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(v2(0) - v3(0))*(v1(1) - v3(1)) +
                    2*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(1) - v2(1))*(2*(v1(1) - v3(1))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(-v1(2) + v3(2))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(0) + v3(0))*(2*(v2(0) - v3(0))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(-v2(2) + v3(2))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(0) - v2(0))*(2*(v2(0) - v3(0))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(-v2(2) + v3(2))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(0) + v3(0))*(v1(1) - v2(1))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                   - (3*(v1(0) - v2(0))*(v1(1) - v2(1))*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),2.5)*
                      sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                           pow(-v2(2) + v3(2),2))))*
           (-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                          v1(0)*v3(1) - v2(0)*v3(1),2) +
                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                          v1(1)*v3(2) - v2(1)*v3(2),2))/
                 (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
                  sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                       pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx2dy2(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(v1(1) - v3(1))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                       v1(0)*v3(1) - v2(0)*v3(1)) +
                    2*(-v1(2) + v3(2))*
                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                     v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                   + ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                               v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),1.5)*
                      sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                           pow(-v2(2) + v3(2),2))))*
           ((2*(-v1(0) + v3(0))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                 v1(0)*v3(1) - v2(0)*v3(1)) +
             2*(v1(2) - v3(2))*(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                       v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                   pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2),2) +
                                   pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                       v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            + ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                        v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),1.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2)))) +
           a0*ksh*(-((2*(v1(1) - v3(1))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(-v1(2) + v3(2))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)))*
                     (2*(-v1(0) + v3(0))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(v1(2) - v3(2))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   ((-v1(0) + v3(0))*(v1(1) - v3(1)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(1) + v3(1))*(2*(v1(1) - v3(1))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(-v1(2) + v3(2))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(1) - v2(1))*(2*(v1(1) - v3(1))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(-v1(2) + v3(2))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(0) + v3(0))*(2*(-v1(0) + v3(0))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(v1(2) - v3(2))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(0) - v2(0))*(2*(-v1(0) + v3(0))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(v1(2) - v3(2))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   (3*(-v2(0) + v3(0))*(-v2(1) + v3(1))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
                   + ((-v2(0) + v3(0))*(v1(1) - v2(1))*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),1.5)*
                      pow(pow(-v2(0) + v3(0),2) +
                          pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                   + ((v1(0) - v2(0))*(-v2(1) + v3(1))*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),1.5)*
                      pow(pow(-v2(0) + v3(0),2) +
                          pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                   + (3*(v1(0) - v2(0))*(v1(1) - v2(1))*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),2.5)*
                      sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                           pow(-v2(2) + v3(2),2))))*
           (-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                          v1(0)*v3(1) - v2(0)*v3(1),2) +
                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                          v1(1)*v3(2) - v2(1)*v3(2),2))/
                 (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
                  sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                       pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx2dy3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(v1(0) - v2(0))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                       v1(0)*v3(1) - v2(0)*v3(1)) +
                    2*(-v1(2) + v2(2))*
                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*((2*(v1(1) - v3(1))*
        (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
         v2(0)*v3(1)) + 2*(-v1(2) + v3(2))*
                        (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                         v2(0)*v3(2)))/
       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                pow(v1(2) - v2(2),2))*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2))*
        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                 v1(0)*v3(1) - v2(0)*v3(1),2) +
             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                 v1(0)*v3(2) + v2(0)*v3(2),2) +
             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                 v1(1)*v3(2) - v2(1)*v3(2),2))) +
       ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                  v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                              pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                  v1(0)*v3(2) + v2(0)*v3(2),2) +
                              pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                  v1(1)*v3(2) - v2(1)*v3(2),2)))/
       (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
             pow(v1(2) - v2(2),2))*
        pow(pow(-v2(0) + v3(0),2) +
            pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
       + ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                   v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                               pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                   v1(0)*v3(2) + v2(0)*v3(2),2) +
                               pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                   v1(1)*v3(2) - v2(1)*v3(2),2)))/
         (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
              pow(v1(2) - v2(2),2),1.5)*
          sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
               pow(-v2(2) + v3(2),2)))) +
           a0*ksh*(-((2*(v1(1) - v3(1))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(-v1(2) + v3(2))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)))*
                     (2*(v1(0) - v2(0))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(-v1(2) + v2(2))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(v1(0) - v2(0))*(v1(1) - v3(1)) -
                    2*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(1) + v3(1))*(2*(v1(1) - v3(1))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(-v1(2) + v3(2))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(0) + v3(0))*(2*(v1(0) - v2(0))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(-v1(2) + v2(2))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(0) - v2(0))*(2*(v1(0) - v2(0))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(-v1(2) + v2(2))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   (3*(-v2(0) + v3(0))*(-v2(1) + v3(1))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
                   - ((v1(0) - v2(0))*(-v2(1) + v3(1))*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),1.5)*
                      pow(pow(-v2(0) + v3(0),2) +
                          pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                            v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx2dz1(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))/
                        (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                              pow(v1(2) - v2(2),2))*
                         sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                              pow(-v2(2) + v3(2),2))))*
           (-((2*(v1(1) - v3(1))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                  v1(0)*v3(1) - v2(0)*v3(1)) +
               2*(-v1(2) + v3(2))*
               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                v1(0)*v3(2) + v2(0)*v3(2)))*
              (2*(-v2(0) + v3(0))*
               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                v1(0)*v3(2) + v2(0)*v3(2)) +
               2*(v2(1) - v3(1))*
               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                v2(1)*v3(2))))/
            (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                     v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
            (2*(-v2(0) + v3(0))*(-v1(2) + v3(2)) -
             2*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                v1(0)*v3(2) + v2(0)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(2) - v2(2))*(2*(v1(1) - v3(1))*
                              (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                               v2(0)*v3(1)) +
                              2*(-v1(2) + v3(2))*
                              (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2))))/
            (2.*pow(pow(v1(0) - v2(0),2) +
                    pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(0) + v3(0))*(2*(-v2(0) + v3(0))*
                               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2)) +
                               2*(v2(1) - v3(1))*
                               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                v2(1)*v3(2))))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((v1(0) - v2(0))*(2*(-v2(0) + v3(0))*
                              (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2)) +
                              2*(v2(1) - v3(1))*
                              (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                               v2(1)*v3(2))))/
            (2.*pow(pow(v1(0) - v2(0),2) +
                    pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((-v2(0) + v3(0))*(v1(2) - v2(2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),1.5)*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            - (3*(v1(0) - v2(0))*(v1(2) - v2(2))*
               sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                        v1(0)*v3(1) - v2(0)*v3(1),2) +
                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),2.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2)))) +
           a0*ksh*((2*(v1(1) - v3(1))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(-v1(2) + v3(2))*
                                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                     v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                   + ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                               v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),1.5)*
                      sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                           pow(-v2(2) + v3(2),2))))*
           ((2*(-v2(0) + v3(0))*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) -
                                 v3(0)*v2(2) - v1(0)*v3(2) + v2(0)*v3(2)) +
             2*(v2(1) - v3(1))*(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                      v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx2dz2(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))/
                        (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                              pow(v1(2) - v2(2),2))*
                         sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                              pow(-v2(2) + v3(2),2))))*
           (-((2*(v1(1) - v3(1))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                  v1(0)*v3(1) - v2(0)*v3(1)) +
               2*(-v1(2) + v3(2))*
               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                v1(0)*v3(2) + v2(0)*v3(2)))*
              (2*(v1(0) - v3(0))*
               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                v1(0)*v3(2) + v2(0)*v3(2)) +
               2*(-v1(1) + v3(1))*
               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                v2(1)*v3(2))))/
            (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                     v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
            ((v1(0) - v3(0))*(-v1(2) + v3(2)))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(2) + v3(2))*(2*(v1(1) - v3(1))*
                               (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                v2(0)*v3(1)) +
                               2*(-v1(2) + v3(2))*
                               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2))))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((v1(2) - v2(2))*(2*(v1(1) - v3(1))*
                              (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                               v2(0)*v3(1)) +
                              2*(-v1(2) + v3(2))*
                              (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2))))/
            (2.*pow(pow(v1(0) - v2(0),2) +
                    pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(0) + v3(0))*(2*(v1(0) - v3(0))*
                               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2)) +
                               2*(-v1(1) + v3(1))*
                               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                v2(1)*v3(2))))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((v1(0) - v2(0))*(2*(v1(0) - v3(0))*
                              (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2)) +
                              2*(-v1(1) + v3(1))*
                              (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                               v2(1)*v3(2))))/
            (2.*pow(pow(v1(0) - v2(0),2) +
                    pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            (3*(-v2(0) + v3(0))*(-v2(2) + v3(2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
            + ((-v2(0) + v3(0))*(v1(2) - v2(2))*
               sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                        v1(0)*v3(1) - v2(0)*v3(1),2) +
                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),1.5)*
               pow(pow(-v2(0) + v3(0),2) +
                   pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            + ((v1(0) - v2(0))*(-v2(2) + v3(2))*
               sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                        v1(0)*v3(1) - v2(0)*v3(1),2) +
                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),1.5)*
               pow(pow(-v2(0) + v3(0),2) +
                   pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            + (3*(v1(0) - v2(0))*(v1(2) - v2(2))*
               sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                        v1(0)*v3(1) - v2(0)*v3(1),2) +
                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),2.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2)))) +
           a0*ksh*((2*(v1(1) - v3(1))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(-v1(2) + v3(2))*
                                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                     v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                   + ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                               v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),1.5)*
                      sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                           pow(-v2(2) + v3(2),2))))*
           ((2*(v1(0) - v3(0))*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2)) +
             2*(-v1(1) + v3(1))*
             (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
              v2(1)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                       v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                   pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2),2) +
                                   pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                       v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            + ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                        v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),1.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx2dz3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(-v1(0) + v2(0))*
                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                     v2(0)*v3(2)) + 2*(v1(1) - v2(1))*
                                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*((2*(v1(1) - v3(1))*
        (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
         v2(0)*v3(1)) + 2*(-v1(2) + v3(2))*
                        (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                         v2(0)*v3(2)))/
       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                pow(v1(2) - v2(2),2))*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2))*
        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                 v1(0)*v3(1) - v2(0)*v3(1),2) +
             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                 v1(0)*v3(2) + v2(0)*v3(2),2) +
             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                 v1(1)*v3(2) - v2(1)*v3(2),2))) +
       ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                  v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                              pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                  v1(0)*v3(2) + v2(0)*v3(2),2) +
                              pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                  v1(1)*v3(2) - v2(1)*v3(2),2)))/
       (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
             pow(v1(2) - v2(2),2))*
        pow(pow(-v2(0) + v3(0),2) +
            pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
       + ((v1(0) - v2(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                   v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                               pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                   v1(0)*v3(2) + v2(0)*v3(2),2) +
                               pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                   v1(1)*v3(2) - v2(1)*v3(2),2)))/
         (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
              pow(v1(2) - v2(2),2),1.5)*
          sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
               pow(-v2(2) + v3(2),2)))) +
           a0*ksh*(-((2*(v1(1) - v3(1))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(-v1(2) + v3(2))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)))*
                     (2*(-v1(0) + v2(0))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)) +
                      2*(v1(1) - v2(1))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(-v1(0) + v2(0))*(-v1(2) + v3(2)) +
                    2*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(2) + v3(2))*(2*(v1(1) - v3(1))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(-v1(2) + v3(2))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(0) + v3(0))*(2*(-v1(0) + v2(0))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2)) +
                                      2*(v1(1) - v2(1))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(0) - v2(0))*(2*(-v1(0) + v2(0))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2)) +
                                     2*(v1(1) - v2(1))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   (3*(-v2(0) + v3(0))*(-v2(2) + v3(2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
                   - ((v1(0) - v2(0))*(-v2(2) + v3(2))*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),1.5)*
                      pow(pow(-v2(0) + v3(0),2) +
                          pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                            v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))));
}

double ddEsh_dx3dx3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*pow((2*(-v1(1) + v2(1))*
                       (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                        v2(0)*v3(1)) + 2*(v1(2) - v2(2))*
                                       (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                        v2(0)*v3(2)))/
                      (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                               pow(v1(2) - v2(2),2))*
                       sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                            pow(-v2(2) + v3(2),2))*
                       sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                v1(0)*v3(1) - v2(0)*v3(1),2) +
                            pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2),2) +
                            pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2),2))) -
                      ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                                 v1(1)*v3(2) - v2(1)*v3(2),2)))/
                      (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                       pow(pow(-v2(0) + v3(0),2) +
                           pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            ,2) + a0*ksh*(-pow(2*(-v1(1) + v2(1))*
                               (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                v2(0)*v3(1)) +
                               2*(v1(2) - v2(2))*
                               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2)),2)/
                          (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                   pow(v1(2) - v2(2),2))*
                           sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                                pow(-v2(2) + v3(2),2))*
                           pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                   v1(0)*v3(1) - v2(0)*v3(1),2) +
                               pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                   v1(0)*v3(2) + v2(0)*v3(2),2) +
                               pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                   v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                          (2*pow(-v1(1) + v2(1),2) + 2*pow(v1(2) - v2(2),2))/
                          (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                   pow(v1(2) - v2(2),2))*
                           sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                                pow(-v2(2) + v3(2),2))*
                           sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                    v1(0)*v3(1) - v2(0)*v3(1),2) +
                                pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                    v1(0)*v3(2) + v2(0)*v3(2),2) +
                                pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                    v1(1)*v3(2) - v2(1)*v3(2),2))) -
                          ((-v2(0) + v3(0))*(2*(-v1(1) + v2(1))*
                                             (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                              v2(0)*v3(1)) +
                                             2*(v1(2) - v2(2))*
                                             (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2))))/
                          (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                pow(v1(2) - v2(2),2))*
                           pow(pow(-v2(0) + v3(0),2) +
                               pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                           sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                    v1(0)*v3(1) - v2(0)*v3(1),2) +
                                pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                    v1(0)*v3(2) + v2(0)*v3(2),2) +
                                pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                    v1(1)*v3(2) - v2(1)*v3(2),2))) +
                          (3*pow(-v2(0) + v3(0),2)*
                           sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                    v1(0)*v3(1) - v2(0)*v3(1),2) +
                                pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                    v1(0)*v3(2) + v2(0)*v3(2),2) +
                                pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                    v1(1)*v3(2) - v2(1)*v3(2),2)))/
                          (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                pow(v1(2) - v2(2),2))*
                           pow(pow(-v2(0) + v3(0),2) +
                               pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
                          - sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                     v1(0)*v3(1) - v2(0)*v3(1),2) +
                                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                     v1(1)*v3(2) - v2(1)*v3(2),2))/
                            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                  pow(v1(2) - v2(2),2))*
                             pow(pow(-v2(0) + v3(0),2) +
                                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                     v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx3dy1(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(-v1(1) + v2(1))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(v1(2) - v2(2))*
                                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                     v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*((2*(v2(0) - v3(0))*
        (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
         v2(0)*v3(1)) + 2*(-v2(2) + v3(2))*
                        (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                         v2(1)*v3(2)))/
       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                pow(v1(2) - v2(2),2))*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2))*
        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                 v1(0)*v3(1) - v2(0)*v3(1),2) +
             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                 v1(0)*v3(2) + v2(0)*v3(2),2) +
             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                 v1(1)*v3(2) - v2(1)*v3(2),2))) -
       ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2)))/
       (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
            pow(v1(2) - v2(2),2),1.5)*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2)))) +
           a0*ksh*(-((2*(-v1(1) + v2(1))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(v1(2) - v2(2))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)))*
                     (2*(v2(0) - v3(0))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(-v2(2) + v3(2))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(v2(0) - v3(0))*(-v1(1) + v2(1)) -
                    2*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(1) - v2(1))*(2*(-v1(1) + v2(1))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(v1(2) - v2(2))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(0) + v3(0))*(2*(v2(0) - v3(0))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(-v2(2) + v3(2))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(0) + v3(0))*(v1(1) - v2(1))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                            v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx3dy2(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(-v1(1) + v2(1))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(v1(2) - v2(2))*
                                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                     v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*((2*(-v1(0) + v3(0))*
        (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
         v2(0)*v3(1)) + 2*(v1(2) - v3(2))*
                        (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                         v2(1)*v3(2)))/
       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                pow(v1(2) - v2(2),2))*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2))*
        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                 v1(0)*v3(1) - v2(0)*v3(1),2) +
             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                 v1(0)*v3(2) + v2(0)*v3(2),2) +
             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                 v1(1)*v3(2) - v2(1)*v3(2),2))) +
       ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                  v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                              pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                  v1(0)*v3(2) + v2(0)*v3(2),2) +
                              pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                  v1(1)*v3(2) - v2(1)*v3(2),2)))/
       (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
             pow(v1(2) - v2(2),2))*
        pow(pow(-v2(0) + v3(0),2) +
            pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
       + ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                   v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                               pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                   v1(0)*v3(2) + v2(0)*v3(2),2) +
                               pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                   v1(1)*v3(2) - v2(1)*v3(2),2)))/
         (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
              pow(v1(2) - v2(2),2),1.5)*
          sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
               pow(-v2(2) + v3(2),2)))) +
           a0*ksh*(-((2*(-v1(1) + v2(1))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(v1(2) - v2(2))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)))*
                     (2*(-v1(0) + v3(0))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(v1(2) - v3(2))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(-v1(0) + v3(0))*(-v1(1) + v2(1)) +
                    2*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(1) + v3(1))*(2*(-v1(1) + v2(1))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(v1(2) - v2(2))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(1) - v2(1))*(2*(-v1(1) + v2(1))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(v1(2) - v2(2))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(0) + v3(0))*(2*(-v1(0) + v3(0))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(v1(2) - v3(2))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   (3*(-v2(0) + v3(0))*(-v2(1) + v3(1))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
                   - ((-v2(0) + v3(0))*(v1(1) - v2(1))*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),1.5)*
                      pow(pow(-v2(0) + v3(0),2) +
                          pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                            v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx3dy3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(-v1(1) + v2(1))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(v1(2) - v2(2))*
                                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                     v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*((2*(v1(0) - v2(0))*
        (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
         v2(0)*v3(1)) + 2*(-v1(2) + v2(2))*
                        (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                         v2(1)*v3(2)))/
       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                pow(v1(2) - v2(2),2))*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2))*
        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                 v1(0)*v3(1) - v2(0)*v3(1),2) +
             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                 v1(0)*v3(2) + v2(0)*v3(2),2) +
             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                 v1(1)*v3(2) - v2(1)*v3(2),2))) -
       ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                  v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                              pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                  v1(0)*v3(2) + v2(0)*v3(2),2) +
                              pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                  v1(1)*v3(2) - v2(1)*v3(2),2)))/
       (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
             pow(v1(2) - v2(2),2))*
        pow(pow(-v2(0) + v3(0),2) +
            pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           ) + a0*ksh*(-((2*(-v1(1) + v2(1))*
                          (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                           v2(0)*v3(1)) +
                          2*(v1(2) - v2(2))*
                          (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                           v1(0)*v3(2) + v2(0)*v3(2)))*
                         (2*(v1(0) - v2(0))*
                          (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                           v2(0)*v3(1)) +
                          2*(-v1(2) + v2(2))*
                          (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                           v2(1)*v3(2))))/
                       (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                pow(v1(2) - v2(2),2))*
                        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                             pow(-v2(2) + v3(2),2))*
                        pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                v1(0)*v3(1) - v2(0)*v3(1),2) +
                            pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2),2) +
                            pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                       ((v1(0) - v2(0))*(-v1(1) + v2(1)))/
                       (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                             pow(v1(2) - v2(2),2))*
                        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                             pow(-v2(2) + v3(2),2))*
                        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                 v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))) -
                       ((-v2(1) + v3(1))*(2*(-v1(1) + v2(1))*
                                          (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                           v2(0)*v3(1)) +
                                          2*(v1(2) - v2(2))*
                                          (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                           v1(0)*v3(2) + v2(0)*v3(2))))/
                       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                pow(v1(2) - v2(2),2))*
                        pow(pow(-v2(0) + v3(0),2) +
                            pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                 v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))) -
                       ((-v2(0) + v3(0))*(2*(v1(0) - v2(0))*
                                          (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                           v2(0)*v3(1)) +
                                          2*(-v1(2) + v2(2))*
                                          (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                           v2(1)*v3(2))))/
                       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                pow(v1(2) - v2(2),2))*
                        pow(pow(-v2(0) + v3(0),2) +
                            pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                 v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))) +
                       (3*(-v2(0) + v3(0))*(-v2(1) + v3(1))*
                        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                 v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2)))/
                       (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                             pow(v1(2) - v2(2),2))*
                        pow(pow(-v2(0) + v3(0),2) +
                            pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
    )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                     v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx3dz1(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*(-((2*(-v1(1) + v2(1))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(v1(2) - v2(2))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)))*
                     (2*(-v2(0) + v3(0))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)) +
                      2*(v2(1) - v3(1))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(-v2(0) + v3(0))*(v1(2) - v2(2)) +
                    2*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(2) - v2(2))*(2*(-v1(1) + v2(1))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(v1(2) - v2(2))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(0) + v3(0))*(2*(-v2(0) + v3(0))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2)) +
                                      2*(v2(1) - v3(1))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(0) + v3(0))*(v1(2) - v2(2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                     v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2)))) +
           a0*ksh*((2*(-v1(1) + v2(1))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(v1(2) - v2(2))*
                                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                     v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           )*((2*(-v2(0) + v3(0))*
               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                v2(0)*v3(2)) + 2*(v2(1) - v3(1))*
                               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                v2(1)*v3(2)))/
              (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2))*
               sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                        v1(0)*v3(1) - v2(0)*v3(1),2) +
                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                        v1(1)*v3(2) - v2(1)*v3(2),2))) -
              ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                        v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),1.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx3dz2(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*(-((2*(-v1(1) + v2(1))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(v1(2) - v2(2))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)))*
                     (2*(v1(0) - v3(0))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)) +
                      2*(-v1(1) + v3(1))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(v1(0) - v3(0))*(v1(2) - v2(2)) -
                    2*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(2) + v3(2))*(2*(-v1(1) + v2(1))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(v1(2) - v2(2))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(2) - v2(2))*(2*(-v1(1) + v2(1))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(v1(2) - v2(2))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(0) + v3(0))*(2*(v1(0) - v3(0))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2)) +
                                      2*(-v1(1) + v3(1))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   (3*(-v2(0) + v3(0))*(-v2(2) + v3(2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
                   - ((-v2(0) + v3(0))*(v1(2) - v2(2))*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),1.5)*
                      pow(pow(-v2(0) + v3(0),2) +
                          pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                     v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2)))) +
           a0*ksh*((2*(-v1(1) + v2(1))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(v1(2) - v2(2))*
                                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                     v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           )*((2*(v1(0) - v3(0))*
               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                v2(0)*v3(2)) + 2*(-v1(1) + v3(1))*
                               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                v2(1)*v3(2)))/
              (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2))*
               sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                        v1(0)*v3(1) - v2(0)*v3(1),2) +
                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                        v1(1)*v3(2) - v2(1)*v3(2),2))) +
              ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                         v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                     pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                         v1(0)*v3(2) + v2(0)*v3(2),2) +
                                     pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                         v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                    pow(v1(2) - v2(2),2))*
               pow(pow(-v2(0) + v3(0),2) +
                   pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
              + ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                          v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                          v1(1)*v3(2) - v2(1)*v3(2),2)))/
                (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2),1.5)*
                 sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                      pow(-v2(2) + v3(2),2))));
}
double ddEsh_dx3dz3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(-v1(1) + v2(1))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(v1(2) - v2(2))*
                                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                                     v2(0)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(0) + v3(0))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*((2*(-v1(0) + v2(0))*
        (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
         v2(0)*v3(2)) + 2*(v1(1) - v2(1))*
                        (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                         v2(1)*v3(2)))/
       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                pow(v1(2) - v2(2),2))*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2))*
        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                 v1(0)*v3(1) - v2(0)*v3(1),2) +
             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                 v1(0)*v3(2) + v2(0)*v3(2),2) +
             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                 v1(1)*v3(2) - v2(1)*v3(2),2))) -
       ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                  v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                              pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                  v1(0)*v3(2) + v2(0)*v3(2),2) +
                              pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                  v1(1)*v3(2) - v2(1)*v3(2),2)))/
       (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
             pow(v1(2) - v2(2),2))*
        pow(pow(-v2(0) + v3(0),2) +
            pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           ) + a0*ksh*(-((2*(-v1(1) + v2(1))*
                          (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                           v2(0)*v3(1)) +
                          2*(v1(2) - v2(2))*
                          (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                           v1(0)*v3(2) + v2(0)*v3(2)))*
                         (2*(-v1(0) + v2(0))*
                          (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                           v1(0)*v3(2) + v2(0)*v3(2)) +
                          2*(v1(1) - v2(1))*
                          (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                           v2(1)*v3(2))))/
                       (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                pow(v1(2) - v2(2),2))*
                        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                             pow(-v2(2) + v3(2),2))*
                        pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                v1(0)*v3(1) - v2(0)*v3(1),2) +
                            pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2),2) +
                            pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                       ((-v1(0) + v2(0))*(v1(2) - v2(2)))/
                       (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                             pow(v1(2) - v2(2),2))*
                        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                             pow(-v2(2) + v3(2),2))*
                        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                 v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))) -
                       ((-v2(2) + v3(2))*(2*(-v1(1) + v2(1))*
                                          (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                           v2(0)*v3(1)) +
                                          2*(v1(2) - v2(2))*
                                          (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                           v1(0)*v3(2) + v2(0)*v3(2))))/
                       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                pow(v1(2) - v2(2),2))*
                        pow(pow(-v2(0) + v3(0),2) +
                            pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                 v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))) -
                       ((-v2(0) + v3(0))*(2*(-v1(0) + v2(0))*
                                          (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                           v1(0)*v3(2) + v2(0)*v3(2)) +
                                          2*(v1(1) - v2(1))*
                                          (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                           v2(1)*v3(2))))/
                       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                pow(v1(2) - v2(2),2))*
                        pow(pow(-v2(0) + v3(0),2) +
                            pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                 v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))) +
                       (3*(-v2(0) + v3(0))*(-v2(2) + v3(2))*
                        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                 v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2)))/
                       (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                             pow(v1(2) - v2(2),2))*
                        pow(pow(-v2(0) + v3(0),2) +
                            pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
    )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                     v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))));
}

double ddEsh_dy1dy1(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*pow((2*(v2(0) - v3(0))*
                       (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                        v2(0)*v3(1)) + 2*(-v2(2) + v3(2))*
                                       (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                        v2(1)*v3(2)))/
                      (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                               pow(v1(2) - v2(2),2))*
                       sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                            pow(-v2(2) + v3(2),2))*
                       sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                v1(0)*v3(1) - v2(0)*v3(1),2) +
                            pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2),2) +
                            pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2),2))) -
                      ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                                v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                            pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                                v1(0)*v3(2) + v2(0)*v3(2),2) +
                                            pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                                v1(1)*v3(2) - v2(1)*v3(2),2)))/
                      (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                           pow(v1(2) - v2(2),2),1.5)*
                       sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                            pow(-v2(2) + v3(2),2))),2) +
           a0*ksh*(-pow(2*(v2(0) - v3(0))*
                        (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                         v2(0)*v3(1)) +
                        2*(-v2(2) + v3(2))*
                        (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                         v2(1)*v3(2)),2)/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*pow(v2(0) - v3(0),2) + 2*pow(-v2(2) + v3(2),2))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(1) - v2(1))*(2*(v2(0) - v3(0))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(-v2(2) + v3(2))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   (3*pow(v1(1) - v2(1),2)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),2.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))) -
                   sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           (-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                          v1(0)*v3(1) - v2(0)*v3(1),2) +
                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                          v1(1)*v3(2) - v2(1)*v3(2),2))/
                 (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
                  sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                       pow(-v2(2) + v3(2),2))));
}
double ddEsh_dy1dy2(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(v2(0) - v3(0))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                       v1(0)*v3(1) - v2(0)*v3(1)) +
                    2*(-v2(2) + v3(2))*
                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                             v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           ((2*(-v1(0) + v3(0))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                 v1(0)*v3(1) - v2(0)*v3(1)) +
             2*(v1(2) - v3(2))*(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                       v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                   pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2),2) +
                                   pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                       v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            + ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                        v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),1.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2)))) +
           a0*ksh*(-((2*(-v1(0) + v3(0))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(v1(2) - v3(2))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2)))*
                     (2*(v2(0) - v3(0))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(-v2(2) + v3(2))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(v2(0) - v3(0))*(-v1(0) + v3(0)) +
                    2*(v1(2) - v3(2))*(-v2(2) + v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(1) - v2(1))*(2*(-v1(0) + v3(0))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(v1(2) - v3(2))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(1) + v3(1))*(2*(v2(0) - v3(0))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(-v2(2) + v3(2))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(1) - v2(1))*(2*(v2(0) - v3(0))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(-v2(2) + v3(2))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(1) - v2(1))*(-v2(1) + v3(1))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                   - (3*pow(v1(1) - v2(1),2)*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),2.5)*
                      sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                           pow(-v2(2) + v3(2),2))) +
                   sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           (-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                          v1(0)*v3(1) - v2(0)*v3(1),2) +
                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                          v1(1)*v3(2) - v2(1)*v3(2),2))/
                 (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
                  sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                       pow(-v2(2) + v3(2),2))));
}
double ddEsh_dy1dy3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(v1(0) - v2(0))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                       v1(0)*v3(1) - v2(0)*v3(1)) +
                    2*(-v1(2) + v2(2))*
                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*((2*(v2(0) - v3(0))*
        (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
         v2(0)*v3(1)) + 2*(-v2(2) + v3(2))*
                        (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                         v2(1)*v3(2)))/
       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                pow(v1(2) - v2(2),2))*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2))*
        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                 v1(0)*v3(1) - v2(0)*v3(1),2) +
             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                 v1(0)*v3(2) + v2(0)*v3(2),2) +
             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                 v1(1)*v3(2) - v2(1)*v3(2),2))) -
       ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2)))/
       (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
            pow(v1(2) - v2(2),2),1.5)*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2)))) +
           a0*ksh*(-((2*(v1(0) - v2(0))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(-v1(2) + v2(2))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2)))*
                     (2*(v2(0) - v3(0))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(-v2(2) + v3(2))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(v1(0) - v2(0))*(v2(0) - v3(0)) +
                    2*(-v1(2) + v2(2))*(-v2(2) + v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(1) - v2(1))*(2*(v1(0) - v2(0))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(-v1(2) + v2(2))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(1) + v3(1))*(2*(v2(0) - v3(0))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(-v2(2) + v3(2))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(1) - v2(1))*(-v2(1) + v3(1))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                            v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))));
}
double ddEsh_dy1dz1(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))/
                        (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                              pow(v1(2) - v2(2),2))*
                         sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                              pow(-v2(2) + v3(2),2))))*
           (-((2*(-v2(0) + v3(0))*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) -
                                   v3(0)*v2(2) - v1(0)*v3(2) + v2(0)*v3(2)) +
               2*(v2(1) - v3(1))*
               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                v2(1)*v3(2)))*
              (2*(v2(0) - v3(0))*
               (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                v2(0)*v3(1)) +
               2*(-v2(2) + v3(2))*
               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                v2(1)*v3(2))))/
            (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                     v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
            ((v2(1) - v3(1))*(-v2(2) + v3(2)))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(1) - v2(1))*(2*(-v2(0) + v3(0))*
                              (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2)) +
                              2*(v2(1) - v3(1))*
                              (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                               v2(1)*v3(2))))/
            (2.*pow(pow(v1(0) - v2(0),2) +
                    pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(2) - v2(2))*(2*(v2(0) - v3(0))*
                              (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                               v2(0)*v3(1)) +
                              2*(-v2(2) + v3(2))*
                              (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                               v2(1)*v3(2))))/
            (2.*pow(pow(v1(0) - v2(0),2) +
                    pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            (3*(v1(1) - v2(1))*(v1(2) - v2(2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),2.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2)))) +
           a0*ksh*((2*(v2(0) - v3(0))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(-v2(2) + v3(2))*
                                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                             v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           ((2*(-v2(0) + v3(0))*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) -
                                 v3(0)*v2(2) - v1(0)*v3(2) + v2(0)*v3(2)) +
             2*(v2(1) - v3(1))*(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                      v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))));
}
double ddEsh_dy1dz2(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))/
                        (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                              pow(v1(2) - v2(2),2))*
                         sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                              pow(-v2(2) + v3(2),2))))*
           (-((2*(v1(0) - v3(0))*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) -
                                  v3(0)*v2(2) - v1(0)*v3(2) + v2(0)*v3(2)) +
               2*(-v1(1) + v3(1))*
               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                v2(1)*v3(2)))*
              (2*(v2(0) - v3(0))*
               (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                v2(0)*v3(1)) +
               2*(-v2(2) + v3(2))*
               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                v2(1)*v3(2))))/
            (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                     v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
            (2*(-v1(1) + v3(1))*(-v2(2) + v3(2)) -
             2*(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                v2(1)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(1) - v2(1))*(2*(v1(0) - v3(0))*
                              (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2)) +
                              2*(-v1(1) + v3(1))*
                              (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                               v2(1)*v3(2))))/
            (2.*pow(pow(v1(0) - v2(0),2) +
                    pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(2) + v3(2))*(2*(v2(0) - v3(0))*
                               (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                v2(0)*v3(1)) +
                               2*(-v2(2) + v3(2))*
                               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                v2(1)*v3(2))))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((v1(2) - v2(2))*(2*(v2(0) - v3(0))*
                              (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                               v2(0)*v3(1)) +
                              2*(-v2(2) + v3(2))*
                              (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                               v2(1)*v3(2))))/
            (2.*pow(pow(v1(0) - v2(0),2) +
                    pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(1) - v2(1))*(-v2(2) + v3(2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),1.5)*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            - (3*(v1(1) - v2(1))*(v1(2) - v2(2))*
               sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                        v1(0)*v3(1) - v2(0)*v3(1),2) +
                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),2.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2)))) +
           a0*ksh*((2*(v2(0) - v3(0))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(-v2(2) + v3(2))*
                                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                             v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           ((2*(v1(0) - v3(0))*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2)) +
             2*(-v1(1) + v3(1))*
             (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
              v2(1)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                       v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                   pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2),2) +
                                   pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                       v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            + ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                        v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),1.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2))));
}
double ddEsh_dy1dz3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(-v1(0) + v2(0))*
                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                     v2(0)*v3(2)) + 2*(v1(1) - v2(1))*
                                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*((2*(v2(0) - v3(0))*
        (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
         v2(0)*v3(1)) + 2*(-v2(2) + v3(2))*
                        (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                         v2(1)*v3(2)))/
       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                pow(v1(2) - v2(2),2))*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2))*
        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                 v1(0)*v3(1) - v2(0)*v3(1),2) +
             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                 v1(0)*v3(2) + v2(0)*v3(2),2) +
             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                 v1(1)*v3(2) - v2(1)*v3(2),2))) -
       ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2)))/
       (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
            pow(v1(2) - v2(2),2),1.5)*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2)))) +
           a0*ksh*(-((2*(-v1(0) + v2(0))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)) +
                      2*(v1(1) - v2(1))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2)))*
                     (2*(v2(0) - v3(0))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(-v2(2) + v3(2))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(v1(1) - v2(1))*(-v2(2) + v3(2)) +
                    2*(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(1) - v2(1))*(2*(-v1(0) + v2(0))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2)) +
                                     2*(v1(1) - v2(1))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(2) + v3(2))*(2*(v2(0) - v3(0))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(-v2(2) + v3(2))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(1) - v2(1))*(-v2(2) + v3(2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                            v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))));
}

double ddEsh_dy2dy2(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*pow((2*(-v1(0) + v3(0))*
                       (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                        v2(0)*v3(1)) + 2*(v1(2) - v3(2))*
                                       (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                        v2(1)*v3(2)))/
                      (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                               pow(v1(2) - v2(2),2))*
                       sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                            pow(-v2(2) + v3(2),2))*
                       sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                v1(0)*v3(1) - v2(0)*v3(1),2) +
                            pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2),2) +
                            pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2),2))) +
                      ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                                 v1(1)*v3(2) - v2(1)*v3(2),2)))/
                      (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                       pow(pow(-v2(0) + v3(0),2) +
                           pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                      + ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                                  v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                              pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                                  v1(0)*v3(2) + v2(0)*v3(2),2) +
                                              pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                                  v1(1)*v3(2) - v2(1)*v3(2),2)))/
                        (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                             pow(v1(2) - v2(2),2),1.5)*
                         sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                              pow(-v2(2) + v3(2),2))),2) +
           a0*ksh*(-pow(2*(-v1(0) + v3(0))*
                        (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                         v2(0)*v3(1)) +
                        2*(v1(2) - v3(2))*
                        (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                         v2(1)*v3(2)),2)/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*pow(-v1(0) + v3(0),2) + 2*pow(v1(2) - v3(2),2))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(1) + v3(1))*(2*(-v1(0) + v3(0))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(v1(2) - v3(2))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(1) - v2(1))*(2*(-v1(0) + v3(0))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(v1(2) - v3(2))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   (3*pow(-v2(1) + v3(1),2)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
                   + (2*(v1(1) - v2(1))*(-v2(1) + v3(1))*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),1.5)*
                      pow(pow(-v2(0) + v3(0),2) +
                          pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                   - sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                              v1(0)*v3(1) - v2(0)*v3(1),2) +
                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                              v1(1)*v3(2) - v2(1)*v3(2),2))/
                     (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                           pow(v1(2) - v2(2),2))*
                      pow(pow(-v2(0) + v3(0),2) +
                          pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                   + (3*pow(v1(1) - v2(1),2)*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),2.5)*
                      sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                           pow(-v2(2) + v3(2),2))) -
                   sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           (-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                          v1(0)*v3(1) - v2(0)*v3(1),2) +
                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                          v1(1)*v3(2) - v2(1)*v3(2),2))/
                 (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
                  sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                       pow(-v2(2) + v3(2),2))));
}
double ddEsh_dy2dy3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(v1(0) - v2(0))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                       v1(0)*v3(1) - v2(0)*v3(1)) +
                    2*(-v1(2) + v2(2))*
                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*((2*(-v1(0) + v3(0))*
        (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
         v2(0)*v3(1)) + 2*(v1(2) - v3(2))*
                        (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                         v2(1)*v3(2)))/
       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                pow(v1(2) - v2(2),2))*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2))*
        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                 v1(0)*v3(1) - v2(0)*v3(1),2) +
             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                 v1(0)*v3(2) + v2(0)*v3(2),2) +
             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                 v1(1)*v3(2) - v2(1)*v3(2),2))) +
       ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                  v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                              pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                  v1(0)*v3(2) + v2(0)*v3(2),2) +
                              pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                  v1(1)*v3(2) - v2(1)*v3(2),2)))/
       (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
             pow(v1(2) - v2(2),2))*
        pow(pow(-v2(0) + v3(0),2) +
            pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
       + ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                   v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                               pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                   v1(0)*v3(2) + v2(0)*v3(2),2) +
                               pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                   v1(1)*v3(2) - v2(1)*v3(2),2)))/
         (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
              pow(v1(2) - v2(2),2),1.5)*
          sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
               pow(-v2(2) + v3(2),2)))) +
           a0*ksh*(-((2*(v1(0) - v2(0))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(-v1(2) + v2(2))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2)))*
                     (2*(-v1(0) + v3(0))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(v1(2) - v3(2))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(v1(0) - v2(0))*(-v1(0) + v3(0)) +
                    2*(-v1(2) + v2(2))*(v1(2) - v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(1) + v3(1))*(2*(v1(0) - v2(0))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(-v1(2) + v2(2))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(1) - v2(1))*(2*(v1(0) - v2(0))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(-v1(2) + v2(2))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(1) + v3(1))*(2*(-v1(0) + v3(0))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(v1(2) - v3(2))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   (3*pow(-v2(1) + v3(1),2)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
                   - ((v1(1) - v2(1))*(-v2(1) + v3(1))*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),1.5)*
                      pow(pow(-v2(0) + v3(0),2) +
                          pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                   + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                              v1(0)*v3(1) - v2(0)*v3(1),2) +
                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                              v1(1)*v3(2) - v2(1)*v3(2),2))/
                     (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                           pow(v1(2) - v2(2),2))*
                      pow(pow(-v2(0) + v3(0),2) +
                          pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                            v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))));
}
double ddEsh_dy2dz1(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))/
                        (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                              pow(v1(2) - v2(2),2))*
                         sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                              pow(-v2(2) + v3(2),2))))*
           (-((2*(-v2(0) + v3(0))*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) -
                                   v3(0)*v2(2) - v1(0)*v3(2) + v2(0)*v3(2)) +
               2*(v2(1) - v3(1))*
               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                v2(1)*v3(2)))*
              (2*(-v1(0) + v3(0))*
               (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                v2(0)*v3(1)) +
               2*(v1(2) - v3(2))*
               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                v2(1)*v3(2))))/
            (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                     v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
            (2*(v2(1) - v3(1))*(v1(2) - v3(2)) +
             2*(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                v2(1)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(1) + v3(1))*(2*(-v2(0) + v3(0))*
                               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2)) +
                               2*(v2(1) - v3(1))*
                               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                v2(1)*v3(2))))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((v1(1) - v2(1))*(2*(-v2(0) + v3(0))*
                              (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2)) +
                              2*(v2(1) - v3(1))*
                              (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                               v2(1)*v3(2))))/
            (2.*pow(pow(v1(0) - v2(0),2) +
                    pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(2) - v2(2))*(2*(-v1(0) + v3(0))*
                              (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                               v2(0)*v3(1)) +
                              2*(v1(2) - v3(2))*
                              (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                               v2(1)*v3(2))))/
            (2.*pow(pow(v1(0) - v2(0),2) +
                    pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((-v2(1) + v3(1))*(v1(2) - v2(2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),1.5)*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            - (3*(v1(1) - v2(1))*(v1(2) - v2(2))*
               sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                        v1(0)*v3(1) - v2(0)*v3(1),2) +
                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),2.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2)))) +
           a0*ksh*((2*(-v1(0) + v3(0))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(v1(2) - v3(2))*
                                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                   + ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                               v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),1.5)*
                      sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                           pow(-v2(2) + v3(2),2))))*
           ((2*(-v2(0) + v3(0))*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) -
                                 v3(0)*v2(2) - v1(0)*v3(2) + v2(0)*v3(2)) +
             2*(v2(1) - v3(1))*(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                      v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))));
}
double ddEsh_dy2dz2(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))/
                        (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                              pow(v1(2) - v2(2),2))*
                         sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                              pow(-v2(2) + v3(2),2))))*
           (-((2*(v1(0) - v3(0))*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) -
                                  v3(0)*v2(2) - v1(0)*v3(2) + v2(0)*v3(2)) +
               2*(-v1(1) + v3(1))*
               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                v2(1)*v3(2)))*
              (2*(-v1(0) + v3(0))*
               (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                v2(0)*v3(1)) +
               2*(v1(2) - v3(2))*
               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                v2(1)*v3(2))))/
            (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                     v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
            ((-v1(1) + v3(1))*(v1(2) - v3(2)))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(1) + v3(1))*(2*(v1(0) - v3(0))*
                               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2)) +
                               2*(-v1(1) + v3(1))*
                               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                v2(1)*v3(2))))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((v1(1) - v2(1))*(2*(v1(0) - v3(0))*
                              (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2)) +
                              2*(-v1(1) + v3(1))*
                              (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                               v2(1)*v3(2))))/
            (2.*pow(pow(v1(0) - v2(0),2) +
                    pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(2) + v3(2))*(2*(-v1(0) + v3(0))*
                               (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                v2(0)*v3(1)) +
                               2*(v1(2) - v3(2))*
                               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                v2(1)*v3(2))))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((v1(2) - v2(2))*(2*(-v1(0) + v3(0))*
                              (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                               v2(0)*v3(1)) +
                              2*(v1(2) - v3(2))*
                              (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                               v2(1)*v3(2))))/
            (2.*pow(pow(v1(0) - v2(0),2) +
                    pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            (3*(-v2(1) + v3(1))*(-v2(2) + v3(2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
            + ((-v2(1) + v3(1))*(v1(2) - v2(2))*
               sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                        v1(0)*v3(1) - v2(0)*v3(1),2) +
                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),1.5)*
               pow(pow(-v2(0) + v3(0),2) +
                   pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            + ((v1(1) - v2(1))*(-v2(2) + v3(2))*
               sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                        v1(0)*v3(1) - v2(0)*v3(1),2) +
                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),1.5)*
               pow(pow(-v2(0) + v3(0),2) +
                   pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            + (3*(v1(1) - v2(1))*(v1(2) - v2(2))*
               sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                        v1(0)*v3(1) - v2(0)*v3(1),2) +
                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),2.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2)))) +
           a0*ksh*((2*(-v1(0) + v3(0))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(v1(2) - v3(2))*
                                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                   + ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                               v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),1.5)*
                      sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                           pow(-v2(2) + v3(2),2))))*
           ((2*(v1(0) - v3(0))*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2)) +
             2*(-v1(1) + v3(1))*
             (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
              v2(1)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                       v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                   pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2),2) +
                                   pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                       v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            + ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                        v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),1.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2))));
}
double ddEsh_dy2dz3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(-v1(0) + v2(0))*
                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                     v2(0)*v3(2)) + 2*(v1(1) - v2(1))*
                                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*((2*(-v1(0) + v3(0))*
        (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
         v2(0)*v3(1)) + 2*(v1(2) - v3(2))*
                        (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                         v2(1)*v3(2)))/
       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                pow(v1(2) - v2(2),2))*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2))*
        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                 v1(0)*v3(1) - v2(0)*v3(1),2) +
             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                 v1(0)*v3(2) + v2(0)*v3(2),2) +
             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                 v1(1)*v3(2) - v2(1)*v3(2),2))) +
       ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                  v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                              pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                  v1(0)*v3(2) + v2(0)*v3(2),2) +
                              pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                  v1(1)*v3(2) - v2(1)*v3(2),2)))/
       (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
             pow(v1(2) - v2(2),2))*
        pow(pow(-v2(0) + v3(0),2) +
            pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
       + ((v1(1) - v2(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                   v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                               pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                   v1(0)*v3(2) + v2(0)*v3(2),2) +
                               pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                   v1(1)*v3(2) - v2(1)*v3(2),2)))/
         (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
              pow(v1(2) - v2(2),2),1.5)*
          sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
               pow(-v2(2) + v3(2),2)))) +
           a0*ksh*(-((2*(-v1(0) + v2(0))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)) +
                      2*(v1(1) - v2(1))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2)))*
                     (2*(-v1(0) + v3(0))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(v1(2) - v3(2))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(v1(1) - v2(1))*(v1(2) - v3(2)) -
                    2*(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(1) + v3(1))*(2*(-v1(0) + v2(0))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2)) +
                                      2*(v1(1) - v2(1))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(1) - v2(1))*(2*(-v1(0) + v2(0))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2)) +
                                     2*(v1(1) - v2(1))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(2) + v3(2))*(2*(-v1(0) + v3(0))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(v1(2) - v3(2))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   (3*(-v2(1) + v3(1))*(-v2(2) + v3(2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
                   - ((v1(1) - v2(1))*(-v2(2) + v3(2))*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),1.5)*
                      pow(pow(-v2(0) + v3(0),2) +
                          pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                            v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))));
}

double ddEsh_dy3dy3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*pow((2*(v1(0) - v2(0))*
                       (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                        v2(0)*v3(1)) + 2*(-v1(2) + v2(2))*
                                       (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                        v2(1)*v3(2)))/
                      (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                               pow(v1(2) - v2(2),2))*
                       sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                            pow(-v2(2) + v3(2),2))*
                       sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                v1(0)*v3(1) - v2(0)*v3(1),2) +
                            pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2),2) +
                            pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2),2))) -
                      ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                                 v1(1)*v3(2) - v2(1)*v3(2),2)))/
                      (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                       pow(pow(-v2(0) + v3(0),2) +
                           pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            ,2) + a0*ksh*(-pow(2*(v1(0) - v2(0))*
                               (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                v2(0)*v3(1)) +
                               2*(-v1(2) + v2(2))*
                               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                v2(1)*v3(2)),2)/
                          (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                   pow(v1(2) - v2(2),2))*
                           sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                                pow(-v2(2) + v3(2),2))*
                           pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                   v1(0)*v3(1) - v2(0)*v3(1),2) +
                               pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                   v1(0)*v3(2) + v2(0)*v3(2),2) +
                               pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                   v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                          (2*pow(v1(0) - v2(0),2) + 2*pow(-v1(2) + v2(2),2))/
                          (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                   pow(v1(2) - v2(2),2))*
                           sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                                pow(-v2(2) + v3(2),2))*
                           sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                    v1(0)*v3(1) - v2(0)*v3(1),2) +
                                pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                    v1(0)*v3(2) + v2(0)*v3(2),2) +
                                pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                    v1(1)*v3(2) - v2(1)*v3(2),2))) -
                          ((-v2(1) + v3(1))*(2*(v1(0) - v2(0))*
                                             (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                              v2(0)*v3(1)) +
                                             2*(-v1(2) + v2(2))*
                                             (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                              v2(1)*v3(2))))/
                          (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                pow(v1(2) - v2(2),2))*
                           pow(pow(-v2(0) + v3(0),2) +
                               pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                           sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                    v1(0)*v3(1) - v2(0)*v3(1),2) +
                                pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                    v1(0)*v3(2) + v2(0)*v3(2),2) +
                                pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                    v1(1)*v3(2) - v2(1)*v3(2),2))) +
                          (3*pow(-v2(1) + v3(1),2)*
                           sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                    v1(0)*v3(1) - v2(0)*v3(1),2) +
                                pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                    v1(0)*v3(2) + v2(0)*v3(2),2) +
                                pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                    v1(1)*v3(2) - v2(1)*v3(2),2)))/
                          (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                pow(v1(2) - v2(2),2))*
                           pow(pow(-v2(0) + v3(0),2) +
                               pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
                          - sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                     v1(0)*v3(1) - v2(0)*v3(1),2) +
                                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                     v1(1)*v3(2) - v2(1)*v3(2),2))/
                            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                  pow(v1(2) - v2(2),2))*
                             pow(pow(-v2(0) + v3(0),2) +
                                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                     v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))));
}
double ddEsh_dy3dz1(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*(-((2*(-v2(0) + v3(0))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)) +
                      2*(v2(1) - v3(1))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2)))*
                     (2*(v1(0) - v2(0))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(-v1(2) + v2(2))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(v2(1) - v3(1))*(-v1(2) + v2(2)) -
                    2*(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(1) + v3(1))*(2*(-v2(0) + v3(0))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2)) +
                                      2*(v2(1) - v3(1))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(2) - v2(2))*(2*(v1(0) - v2(0))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(-v1(2) + v2(2))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(1) + v3(1))*(v1(2) - v2(2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                     v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2)))) +
           a0*ksh*((2*(v1(0) - v2(0))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(-v1(2) + v2(2))*
                                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           )*((2*(-v2(0) + v3(0))*
               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                v2(0)*v3(2)) + 2*(v2(1) - v3(1))*
                               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                v2(1)*v3(2)))/
              (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2))*
               sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                        v1(0)*v3(1) - v2(0)*v3(1),2) +
                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                        v1(1)*v3(2) - v2(1)*v3(2),2))) -
              ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                        v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),1.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2))));
}
double ddEsh_dy3dz2(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*(-((2*(v1(0) - v3(0))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)) +
                      2*(-v1(1) + v3(1))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2)))*
                     (2*(v1(0) - v2(0))*
                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                       v2(0)*v3(1)) +
                      2*(-v1(2) + v2(2))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(-v1(1) + v3(1))*(-v1(2) + v2(2)) +
                    2*(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(1) + v3(1))*(2*(v1(0) - v3(0))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2)) +
                                      2*(-v1(1) + v3(1))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(2) + v3(2))*(2*(v1(0) - v2(0))*
                                      (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                       v2(0)*v3(1)) +
                                      2*(-v1(2) + v2(2))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(2) - v2(2))*(2*(v1(0) - v2(0))*
                                     (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                      v2(0)*v3(1)) +
                                     2*(-v1(2) + v2(2))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   (3*(-v2(1) + v3(1))*(-v2(2) + v3(2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
                   - ((-v2(1) + v3(1))*(v1(2) - v2(2))*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),1.5)*
                      pow(pow(-v2(0) + v3(0),2) +
                          pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                     v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2)))) +
           a0*ksh*((2*(v1(0) - v2(0))*
                    (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                     v2(0)*v3(1)) + 2*(-v1(2) + v2(2))*
                                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           )*((2*(v1(0) - v3(0))*
               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                v2(0)*v3(2)) + 2*(-v1(1) + v3(1))*
                               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                v2(1)*v3(2)))/
              (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2))*
               sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                        v1(0)*v3(1) - v2(0)*v3(1),2) +
                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                        v1(1)*v3(2) - v2(1)*v3(2),2))) +
              ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                         v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                     pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                         v1(0)*v3(2) + v2(0)*v3(2),2) +
                                     pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                         v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                    pow(v1(2) - v2(2),2))*
               pow(pow(-v2(0) + v3(0),2) +
                   pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
              + ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                          v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                          v1(1)*v3(2) - v2(1)*v3(2),2)))/
                (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2),1.5)*
                 sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                      pow(-v2(2) + v3(2),2))));
}
double ddEsh_dy3dz3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(v1(0) - v2(0))*(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                       v1(0)*v3(1) - v2(0)*v3(1)) +
                    2*(-v1(2) + v2(2))*
                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(1) + v3(1))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*((2*(-v1(0) + v2(0))*
        (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
         v2(0)*v3(2)) + 2*(v1(1) - v2(1))*
                        (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                         v2(1)*v3(2)))/
       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                pow(v1(2) - v2(2),2))*
        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
             pow(-v2(2) + v3(2),2))*
        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                 v1(0)*v3(1) - v2(0)*v3(1),2) +
             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                 v1(0)*v3(2) + v2(0)*v3(2),2) +
             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                 v1(1)*v3(2) - v2(1)*v3(2),2))) -
       ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                  v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                              pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                  v1(0)*v3(2) + v2(0)*v3(2),2) +
                              pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                  v1(1)*v3(2) - v2(1)*v3(2),2)))/
       (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
             pow(v1(2) - v2(2),2))*
        pow(pow(-v2(0) + v3(0),2) +
            pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           ) + a0*ksh*(-((2*(-v1(0) + v2(0))*
                          (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                           v1(0)*v3(2) + v2(0)*v3(2)) +
                          2*(v1(1) - v2(1))*
                          (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                           v2(1)*v3(2)))*
                         (2*(v1(0) - v2(0))*
                          (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                           v2(0)*v3(1)) +
                          2*(-v1(2) + v2(2))*
                          (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                           v2(1)*v3(2))))/
                       (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                pow(v1(2) - v2(2),2))*
                        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                             pow(-v2(2) + v3(2),2))*
                        pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                v1(0)*v3(1) - v2(0)*v3(1),2) +
                            pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2),2) +
                            pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                       ((v1(1) - v2(1))*(-v1(2) + v2(2)))/
                       (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                             pow(v1(2) - v2(2),2))*
                        sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                             pow(-v2(2) + v3(2),2))*
                        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                 v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))) -
                       ((-v2(1) + v3(1))*(2*(-v1(0) + v2(0))*
                                          (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                           v1(0)*v3(2) + v2(0)*v3(2)) +
                                          2*(v1(1) - v2(1))*
                                          (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                           v2(1)*v3(2))))/
                       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                pow(v1(2) - v2(2),2))*
                        pow(pow(-v2(0) + v3(0),2) +
                            pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                 v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))) -
                       ((-v2(2) + v3(2))*(2*(v1(0) - v2(0))*
                                          (v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) -
                                           v2(0)*v3(1)) +
                                          2*(-v1(2) + v2(2))*
                                          (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                           v2(1)*v3(2))))/
                       (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                pow(v1(2) - v2(2),2))*
                        pow(pow(-v2(0) + v3(0),2) +
                            pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                 v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))) +
                       (3*(-v2(1) + v3(1))*(-v2(2) + v3(2))*
                        sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                 v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2)))/
                       (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                             pow(v1(2) - v2(2),2))*
                        pow(pow(-v2(0) + v3(0),2) +
                            pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
    )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                     v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))));
}

double ddEsh_dz1dz1(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*pow((2*(-v2(0) + v3(0))*
                       (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                        v2(0)*v3(2)) + 2*(v2(1) - v3(1))*
                                       (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                        v2(1)*v3(2)))/
                      (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                               pow(v1(2) - v2(2),2))*
                       sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                            pow(-v2(2) + v3(2),2))*
                       sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                v1(0)*v3(1) - v2(0)*v3(1),2) +
                            pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2),2) +
                            pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2),2))) -
                      ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                                v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                            pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                                v1(0)*v3(2) + v2(0)*v3(2),2) +
                                            pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                                v1(1)*v3(2) - v2(1)*v3(2),2)))/
                      (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                           pow(v1(2) - v2(2),2),1.5)*
                       sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                            pow(-v2(2) + v3(2),2))),2) +
           a0*ksh*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))/
                        (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                              pow(v1(2) - v2(2),2))*
                         sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                              pow(-v2(2) + v3(2),2))))*
           (-pow(2*(-v2(0) + v3(0))*
                 (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                  v1(0)*v3(2) + v2(0)*v3(2)) +
                 2*(v2(1) - v3(1))*
                 (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                  v2(1)*v3(2)),2)/
            (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                     v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
            (2*pow(-v2(0) + v3(0),2) + 2*pow(v2(1) - v3(1),2))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(2) - v2(2))*(2*(-v2(0) + v3(0))*
                              (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2)) +
                              2*(v2(1) - v3(1))*
                              (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                               v2(1)*v3(2))))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                     v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))) +
            (3*pow(v1(2) - v2(2),2)*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),2.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))));
}
double ddEsh_dz1dz2(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*((2*(-v2(0) + v3(0))*
                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                     v2(0)*v3(2)) + 2*(v2(1) - v3(1))*
                                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                             v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))))*
           ((2*(v1(0) - v3(0))*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2)) +
             2*(-v1(1) + v3(1))*
             (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
              v2(1)*v3(2)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                       v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                   pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2),2) +
                                   pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                       v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            + ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                        v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),1.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2)))) +
           a0*ksh*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))/
                        (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                              pow(v1(2) - v2(2),2))*
                         sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                              pow(-v2(2) + v3(2),2))))*
           (-((2*(-v2(0) + v3(0))*(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) -
                                   v3(0)*v2(2) - v1(0)*v3(2) + v2(0)*v3(2)) +
               2*(v2(1) - v3(1))*
               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                v2(1)*v3(2)))*
              (2*(v1(0) - v3(0))*
               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                v1(0)*v3(2) + v2(0)*v3(2)) +
               2*(-v1(1) + v3(1))*
               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                v2(1)*v3(2))))/
            (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                     v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
            (2*(v1(0) - v3(0))*(-v2(0) + v3(0)) +
             2*(v2(1) - v3(1))*(-v1(1) + v3(1)))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(2) + v3(2))*(2*(-v2(0) + v3(0))*
                               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2)) +
                               2*(v2(1) - v3(1))*
                               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                v2(1)*v3(2))))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((v1(2) - v2(2))*(2*(-v2(0) + v3(0))*
                              (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2)) +
                              2*(v2(1) - v3(1))*
                              (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                               v2(1)*v3(2))))/
            (2.*pow(pow(v1(0) - v2(0),2) +
                    pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(2) - v2(2))*(2*(v1(0) - v3(0))*
                              (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2)) +
                              2*(-v1(1) + v3(1))*
                              (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                               v2(1)*v3(2))))/
            (2.*pow(pow(v1(0) - v2(0),2) +
                    pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) -
            ((v1(2) - v2(2))*(-v2(2) + v3(2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),1.5)*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                       v1(0)*v3(1) - v2(0)*v3(1),2) +
                   pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2),2) +
                   pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                       v1(1)*v3(2) - v2(1)*v3(2),2))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),1.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2))) -
            (3*pow(v1(2) - v2(2),2)*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),2.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))));
}
double ddEsh_dz1dz3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*(-((2*(-v1(0) + v2(0))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)) +
                      2*(v1(1) - v2(1))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2)))*
                     (2*(-v2(0) + v3(0))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)) +
                      2*(v2(1) - v3(1))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(-v1(0) + v2(0))*(-v2(0) + v3(0)) +
                    2*(v1(1) - v2(1))*(v2(1) - v3(1)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((v1(2) - v2(2))*(2*(-v1(0) + v2(0))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2)) +
                                     2*(v1(1) - v2(1))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(2) + v3(2))*(2*(-v2(0) + v3(0))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2)) +
                                      2*(v2(1) - v3(1))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(2) - v2(2))*(-v2(2) + v3(2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                        pow(v1(2) - v2(2),2),1.5)*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                     v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2)))) +
           a0*ksh*((2*(-v1(0) + v2(0))*
                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                     v2(0)*v3(2)) + 2*(v1(1) - v2(1))*
                                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           )*((2*(-v2(0) + v3(0))*
               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                v2(0)*v3(2)) + 2*(v2(1) - v3(1))*
                               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                v2(1)*v3(2)))/
              (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2))*
               sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                        v1(0)*v3(1) - v2(0)*v3(1),2) +
                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                        v1(1)*v3(2) - v2(1)*v3(2),2))) -
              ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                        v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),1.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2))));
}

double ddEsh_dz2dz2(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*pow((2*(v1(0) - v3(0))*
                       (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                        v2(0)*v3(2)) + 2*(-v1(1) + v3(1))*
                                       (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                        v2(1)*v3(2)))/
                      (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                               pow(v1(2) - v2(2),2))*
                       sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                            pow(-v2(2) + v3(2),2))*
                       sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                v1(0)*v3(1) - v2(0)*v3(1),2) +
                            pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2),2) +
                            pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2),2))) +
                      ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                                 v1(1)*v3(2) - v2(1)*v3(2),2)))/
                      (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                       pow(pow(-v2(0) + v3(0),2) +
                           pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                      + ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                                  v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                              pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                                  v1(0)*v3(2) + v2(0)*v3(2),2) +
                                              pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                                  v1(1)*v3(2) - v2(1)*v3(2),2)))/
                        (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                             pow(v1(2) - v2(2),2),1.5)*
                         sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                              pow(-v2(2) + v3(2),2))),2) +
           a0*ksh*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                 v1(1)*v3(2) - v2(1)*v3(2),2))/
                        (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                              pow(v1(2) - v2(2),2))*
                         sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                              pow(-v2(2) + v3(2),2))))*
           (-pow(2*(v1(0) - v3(0))*
                 (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                  v1(0)*v3(2) + v2(0)*v3(2)) +
                 2*(-v1(1) + v3(1))*
                 (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                  v2(1)*v3(2)),2)/
            (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                     v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
            (2*pow(v1(0) - v3(0),2) + 2*pow(-v1(1) + v3(1),2))/
            (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((-v2(2) + v3(2))*(2*(v1(0) - v3(0))*
                               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2)) +
                               2*(-v1(1) + v3(1))*
                               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                v2(1)*v3(2))))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            ((v1(2) - v2(2))*(2*(v1(0) - v3(0))*
                              (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2)) +
                              2*(-v1(1) + v3(1))*
                              (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                               v2(1)*v3(2))))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),1.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2))) +
            (3*pow(-v2(2) + v3(2),2)*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             pow(pow(-v2(0) + v3(0),2) +
                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
            - sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                       v1(0)*v3(1) - v2(0)*v3(1),2) +
                   pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2),2) +
                   pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                       v1(1)*v3(2) - v2(1)*v3(2),2))/
              (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                    pow(v1(2) - v2(2),2))*
               pow(pow(-v2(0) + v3(0),2) +
                   pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            + (2*(v1(2) - v2(2))*(-v2(2) + v3(2))*
               sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                        v1(0)*v3(1) - v2(0)*v3(1),2) +
                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                        v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),1.5)*
               pow(pow(-v2(0) + v3(0),2) +
                   pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            - sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                       v1(0)*v3(1) - v2(0)*v3(1),2) +
                   pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2),2) +
                   pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                       v1(1)*v3(2) - v2(1)*v3(2),2))/
              (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                   pow(v1(2) - v2(2),2),1.5)*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2))) +
            (3*pow(v1(2) - v2(2),2)*
             sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                      v1(0)*v3(1) - v2(0)*v3(1),2) +
                  pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                      v1(0)*v3(2) + v2(0)*v3(2),2) +
                  pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                      v1(1)*v3(2) - v2(1)*v3(2),2)))/
            (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                 pow(v1(2) - v2(2),2),2.5)*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))));
}
double ddEsh_dz2dz3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*(-((2*(-v1(0) + v2(0))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)) +
                      2*(v1(1) - v2(1))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2)))*
                     (2*(v1(0) - v3(0))*
                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                       v1(0)*v3(2) + v2(0)*v3(2)) +
                      2*(-v1(1) + v3(1))*
                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                       v2(1)*v3(2))))/
                   (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                            v1(0)*v3(1) - v2(0)*v3(1),2) +
                        pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                            v1(0)*v3(2) + v2(0)*v3(2),2) +
                        pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                            v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                   (2*(-v1(0) + v2(0))*(v1(0) - v3(0)) +
                    2*(v1(1) - v2(1))*(-v1(1) + v3(1)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((-v2(2) + v3(2))*(2*(-v1(0) + v2(0))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2)) +
                                      2*(v1(1) - v2(1))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) +
                   ((v1(2) - v2(2))*(2*(-v1(0) + v2(0))*
                                     (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                      v1(0)*v3(2) + v2(0)*v3(2)) +
                                     2*(v1(1) - v2(1))*
                                     (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                      v2(1)*v3(2))))/
                   (2.*pow(pow(v1(0) - v2(0),2) +
                           pow(v1(1) - v2(1),2) + pow(v1(2) - v2(2),2),1.5)*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(2) + v3(2))*(2*(v1(0) - v3(0))*
                                      (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                       v1(0)*v3(2) + v2(0)*v3(2)) +
                                      2*(-v1(1) + v3(1))*
                                      (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                       v2(1)*v3(2))))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   (3*pow(-v2(2) + v3(2),2)*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
                   + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                              v1(0)*v3(1) - v2(0)*v3(1),2) +
                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                              v1(1)*v3(2) - v2(1)*v3(2),2))/
                     (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                           pow(v1(2) - v2(2),2))*
                      pow(pow(-v2(0) + v3(0),2) +
                          pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
                   - ((v1(2) - v2(2))*(-v2(2) + v3(2))*
                      sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                               v1(0)*v3(1) - v2(0)*v3(1),2) +
                           pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                               v1(0)*v3(2) + v2(0)*v3(2),2) +
                           pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                               v1(1)*v3(2) - v2(1)*v3(2),2)))/
                     (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                          pow(v1(2) - v2(2),2),1.5)*
                      pow(pow(-v2(0) + v3(0),2) +
                          pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                     v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2)))) +
           a0*ksh*((2*(-v1(0) + v2(0))*
                    (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                     v2(0)*v3(2)) + 2*(v1(1) - v2(1))*
                                    (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                     v2(1)*v3(2)))/
                   (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                    sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                         pow(-v2(2) + v3(2),2))*
                    sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                             v1(0)*v3(1) - v2(0)*v3(1),2) +
                         pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                             v1(0)*v3(2) + v2(0)*v3(2),2) +
                         pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                             v1(1)*v3(2) - v2(1)*v3(2),2))) -
                   ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                              v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                          pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2),2) +
                                          pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                              v1(1)*v3(2) - v2(1)*v3(2),2)))/
                   (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                         pow(v1(2) - v2(2),2))*
                    pow(pow(-v2(0) + v3(0),2) +
                        pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
           )*((2*(v1(0) - v3(0))*
               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                v2(0)*v3(2)) + 2*(-v1(1) + v3(1))*
                               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                v2(1)*v3(2)))/
              (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                       pow(v1(2) - v2(2),2))*
               sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                    pow(-v2(2) + v3(2),2))*
               sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                        v1(0)*v3(1) - v2(0)*v3(1),2) +
                    pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                        v1(0)*v3(2) + v2(0)*v3(2),2) +
                    pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                        v1(1)*v3(2) - v2(1)*v3(2),2))) +
              ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                         v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                     pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                         v1(0)*v3(2) + v2(0)*v3(2),2) +
                                     pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                         v1(1)*v3(2) - v2(1)*v3(2),2)))/
              (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                    pow(v1(2) - v2(2),2))*
               pow(pow(-v2(0) + v3(0),2) +
                   pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
              + ((v1(2) - v2(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) -
                                          v1(0)*v2(1) + v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                      pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                          v1(0)*v3(2) + v2(0)*v3(2),2) +
                                      pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                          v1(1)*v3(2) - v2(1)*v3(2),2)))/
                (pow(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                     pow(v1(2) - v2(2),2),1.5)*
                 sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                      pow(-v2(2) + v3(2),2))));
}
double ddEsh_dz3dz3(const Eigen::Vector3d& v1, const Eigen::Vector3d& v2, const Eigen::Vector3d& v3,
                    const double& a0, const double& ksh) {
    return a0*ksh*pow((2*(-v1(0) + v2(0))*
                       (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) - v1(0)*v3(2) +
                        v2(0)*v3(2)) + 2*(v1(1) - v2(1))*
                                       (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                        v2(1)*v3(2)))/
                      (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                               pow(v1(2) - v2(2),2))*
                       sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                            pow(-v2(2) + v3(2),2))*
                       sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                v1(0)*v3(1) - v2(0)*v3(1),2) +
                            pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2),2) +
                            pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                v1(1)*v3(2) - v2(1)*v3(2),2))) -
                      ((-v2(2) + v3(2))*sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                                                 v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                                             pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                                 v1(0)*v3(2) + v2(0)*v3(2),2) +
                                             pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                                 v1(1)*v3(2) - v2(1)*v3(2),2)))/
                      (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                            pow(v1(2) - v2(2),2))*
                       pow(pow(-v2(0) + v3(0),2) +
                           pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
            ,2) + a0*ksh*(-pow(2*(-v1(0) + v2(0))*
                               (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                v1(0)*v3(2) + v2(0)*v3(2)) +
                               2*(v1(1) - v2(1))*
                               (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                v2(1)*v3(2)),2)/
                          (4.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                   pow(v1(2) - v2(2),2))*
                           sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                                pow(-v2(2) + v3(2),2))*
                           pow(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                   v1(0)*v3(1) - v2(0)*v3(1),2) +
                               pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                   v1(0)*v3(2) + v2(0)*v3(2),2) +
                               pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                   v1(1)*v3(2) - v2(1)*v3(2),2),1.5)) +
                          (2*pow(-v1(0) + v2(0),2) + 2*pow(v1(1) - v2(1),2))/
                          (2.*sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                   pow(v1(2) - v2(2),2))*
                           sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                                pow(-v2(2) + v3(2),2))*
                           sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                    v1(0)*v3(1) - v2(0)*v3(1),2) +
                                pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                    v1(0)*v3(2) + v2(0)*v3(2),2) +
                                pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                    v1(1)*v3(2) - v2(1)*v3(2),2))) -
                          ((-v2(2) + v3(2))*(2*(-v1(0) + v2(0))*
                                             (-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                              v1(0)*v3(2) + v2(0)*v3(2)) +
                                             2*(v1(1) - v2(1))*
                                             (v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) + v1(1)*v3(2) -
                                              v2(1)*v3(2))))/
                          (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                pow(v1(2) - v2(2),2))*
                           pow(pow(-v2(0) + v3(0),2) +
                               pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5)*
                           sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                    v1(0)*v3(1) - v2(0)*v3(1),2) +
                                pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                    v1(0)*v3(2) + v2(0)*v3(2),2) +
                                pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                    v1(1)*v3(2) - v2(1)*v3(2),2))) +
                          (3*pow(-v2(2) + v3(2),2)*
                           sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                    v1(0)*v3(1) - v2(0)*v3(1),2) +
                                pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                    v1(0)*v3(2) + v2(0)*v3(2),2) +
                                pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                    v1(1)*v3(2) - v2(1)*v3(2),2)))/
                          (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                pow(v1(2) - v2(2),2))*
                           pow(pow(-v2(0) + v3(0),2) +
                               pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),2.5))
                          - sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) + v3(0)*v2(1) +
                                     v1(0)*v3(1) - v2(0)*v3(1),2) +
                                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                                     v1(1)*v3(2) - v2(1)*v3(2),2))/
                            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                                  pow(v1(2) - v2(2),2))*
                             pow(pow(-v2(0) + v3(0),2) +
                                 pow(-v2(1) + v3(1),2) + pow(-v2(2) + v3(2),2),1.5))
    )*(-1 + sqrt(pow(v2(0)*v1(1) - v3(0)*v1(1) - v1(0)*v2(1) +
                     v3(0)*v2(1) + v1(0)*v3(1) - v2(0)*v3(1),2) +
                 pow(-(v2(0)*v1(2)) + v3(0)*v1(2) + v1(0)*v2(2) - v3(0)*v2(2) -
                     v1(0)*v3(2) + v2(0)*v3(2),2) +
                 pow(v2(1)*v1(2) - v3(1)*v1(2) - v1(1)*v2(2) + v3(1)*v2(2) +
                     v1(1)*v3(2) - v2(1)*v3(2),2))/
            (sqrt(pow(v1(0) - v2(0),2) + pow(v1(1) - v2(1),2) +
                  pow(v1(2) - v2(2),2))*
             sqrt(pow(-v2(0) + v3(0),2) + pow(-v2(1) + v3(1),2) +
                  pow(-v2(2) + v3(2),2))));
}